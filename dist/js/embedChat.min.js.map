{"version":3,"file":"embedChat.min.js","sources":["../../src/js/lib/utils.ts","../../src/js/embedChat.ts"],"sourcesContent":["export function isMobileBrowser(): boolean {\n  const userAgent = navigator.userAgent || navigator.vendor\n  const mobileAgents = [\n    /android/i,\n    /iphone/i,\n    /ipad/i,\n    /ipod/i,\n    /blackberry/i,\n    /windows phone/i,\n    /opera mini/i,\n    /iemobile/i,\n    /mobile/i,\n  ]\n  return mobileAgents.some((mobileAgent) => mobileAgent.test(userAgent))\n}\n\nexport function browserHeightLessThan(height: number): boolean {\n  const currentHeight =\n    window.innerHeight ||\n    document.documentElement.clientHeight ||\n    document.body.clientHeight\n  return currentHeight < height\n}\n\nexport function scrollToElement(\n  elem: HTMLElement,\n  scrollOffset: number = 0\n): void {\n  const elementPosition = elem.getBoundingClientRect().top + window.pageYOffset\n  const offsetPosition = elementPosition - scrollOffset\n\n  window.scrollTo({\n    top: offsetPosition,\n    behavior: \"smooth\",\n  })\n}\n","/**\n * Level Up Embed Chat\n *\n * Embeds GHL chat widget into a page. Works anywhere the GHL chat widget is embedded.\n *\n * If current browser is mobile or the height is less than minHeight option,\n * chat widget will be opened and not embedded. This prevents scroll issues\n * on mobile or small screens where the chat widget is larger than the current\n * browser height.\n *\n * Usage:\n\n<div id=\"ghl-chat-embed\"></div>\n<script type=\"module\">\n  import { embedChat } from \"https://cdn.jsdelivr.net/gh/levelupghl/ghlchattools@v1/dist/js/embedChat.min.js\";\n  embedChat(\"#ghl-chat-embed\", {minHeight: 700, autoScroll: true});\n</script>\n\n **/\n\nimport {\n  browserHeightLessThan,\n  isMobileBrowser,\n  scrollToElement,\n} from \"./lib/utils\"\n\nconst CHAT_EMBED_CONTAINER_SELECTOR = \"#ghl-chat-embed\"\nconst GHL_CHAT_WIDGET_SELECTOR = \"chat-widget\"\nconst DEFAULT_OPTIONS: Options = {\n  minHeight: 650,\n  autoScroll: false,\n  scrollOffset: 20,\n}\n\ninterface Options {\n  minHeight: number\n  autoScroll: boolean\n  scrollOffset: number\n}\n\nasync function waitForChatLoad(): Promise<void> {\n  return new Promise<void>((resolve) => {\n    const handler = (event: LCChatWidgetLoadedEvent) => {\n      resolve()\n      window.removeEventListener(\"LC_chatWidgetLoaded\", handler)\n    }\n    window.addEventListener(\"LC_chatWidgetLoaded\", handler, false)\n  })\n}\n\nfunction getOptions(options: Options | undefined): Options {\n  const opts = { ...DEFAULT_OPTIONS }\n  if (!options) {\n    return opts\n  }\n  try {\n    if (options.minHeight) {\n      opts.minHeight =\n        typeof options.minHeight === \"number\"\n          ? options.minHeight\n          : parseInt(options.minHeight)\n    }\n    if (options.autoScroll) {\n      opts.autoScroll = true\n      if (options.scrollOffset) {\n        opts.scrollOffset =\n          typeof options.scrollOffset === \"number\"\n            ? options.scrollOffset\n            : parseInt(options.scrollOffset)\n      }\n    }\n  } catch (err) {\n    console.error(`embedChat: invalid options, using defaults`)\n  }\n  return opts\n}\n\nexport const embedChat = async (\n  containerSelector: string | undefined,\n  options: Options | undefined\n) => {\n  const selector = containerSelector || CHAT_EMBED_CONTAINER_SELECTOR\n  const opts = getOptions(options)\n  const embedDiv = document.querySelector(selector) as HTMLElement\n\n  if (!embedDiv) {\n    console.error(\n      `embedChat: \"${selector}\" not found on page: unable to embed GHL chat widget`\n    )\n    return\n  }\n  if (!window.leadConnector?.chatWidget?.isLoaded) {\n    await waitForChatLoad()\n  }\n\n  // Open chat widget instead of embedding on mobile or small screens\n  if (isMobileBrowser() || browserHeightLessThan(opts.minHeight)) {\n    return window.leadConnector.chatWidget.openWidget()\n  }\n\n  const chat = document.querySelector(GHL_CHAT_WIDGET_SELECTOR)\n  const root = chat?.shadowRoot\n\n  if (!chat || !root) {\n    console.error(`embedChat: unable to find GHL chat widget on page`)\n    return\n  }\n\n  const bubble = root.querySelector(\".lc_text-widget--bubble\") as HTMLElement\n  const widget = root.querySelector(\".lc_text-widget\") as HTMLElement\n  const box = root.querySelector(\".lc_text-widget--box\") as HTMLElement\n\n  if (!bubble || !widget || !box) {\n    console.error(\n      `embedChat: unable to embed GHL chat widget in page: widget components not found`\n    )\n    return\n  }\n\n  // Remove the chat widget\n  chat.parentElement?.removeChild(chat)\n\n  // TODO: set overscroll to auto\n\n  widget.style.position = \"static\"\n  widget.style.width = \"100%\"\n  box.style.width = \"100%\"\n\n  // Hide the chat bubble\n  bubble.style.display = \"none\"\n\n  // Attach the chat widget to the in page container\n  embedDiv.appendChild(chat)\n\n  // Open chat widget\n  window.leadConnector.chatWidget.openWidget()\n\n  if (opts.autoScroll) {\n    setTimeout(() => {\n      scrollToElement(embedDiv, opts.scrollOffset)\n    }, 100)\n  }\n\n  // TODO: wait until after button click or observe DOM before attempting to get inner-scroll\n  // const innerscroll = root\n  //   .querySelector(\"chat-pane\")\n  //   .shadowRoot.querySelector(\"chat-conversation\")\n  //   .shadowRoot.querySelector(\"ion-content\")\n  //   .shadowRoot.querySelector(\".inner-scroll\") as HTMLElement\n  // if (inner?.style) {\n  //   inner.style.overscrollBehavior = \"auto\"\n  // }\n  // TODO: set ::slotted(.informational) fontSize = 14px\n}\n\n"],"names":["isMobileBrowser","userAgent","mobileAgent","browserHeightLessThan","height","scrollToElement","elem","scrollOffset","offsetPosition","w","h","L","g","b","a","c","i","r","s","d","l","CHAT_EMBED_CONTAINER_SELECTOR","GHL_CHAT_WIDGET_SELECTOR","DEFAULT_OPTIONS","waitForChatLoad","__async","resolve","handler","event","getOptions","options","opts","__spreadValues","err","embedChat","containerSelector","_a","_b","_c","selector","embedDiv","chat","root","bubble","widget","box"],"mappings":"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"}