{"version":3,"file":"embedChat.js","sources":["../../src/js/lib/utils.ts","../../src/js/embedChat.ts"],"sourcesContent":["export function isMobileBrowser(): boolean {\n  const userAgent = navigator.userAgent || navigator.vendor\n  const mobileAgents = [\n    /android/i,\n    /iphone/i,\n    /ipad/i,\n    /ipod/i,\n    /blackberry/i,\n    /windows phone/i,\n    /opera mini/i,\n    /iemobile/i,\n    /mobile/i,\n  ]\n  return mobileAgents.some((mobileAgent) => mobileAgent.test(userAgent))\n}\n\nexport function browserHeightLessThan(height: number): boolean {\n  const currentHeight =\n    window.innerHeight ||\n    document.documentElement.clientHeight ||\n    document.body.clientHeight\n  return currentHeight < height\n}\n\nexport function scrollToElement(\n  elem: HTMLElement,\n  scrollOffset: number = 0\n): void {\n  const elementPosition = elem.getBoundingClientRect().top + window.pageYOffset\n  const offsetPosition = elementPosition - scrollOffset\n\n  window.scrollTo({\n    top: offsetPosition,\n    behavior: \"smooth\",\n  })\n}\n","/**\n * Level Up Embed Chat\n *\n * Embeds GHL chat widget into a page. Works anywhere the GHL chat widget is embedded.\n *\n * If current browser is mobile or the height is less than minHeight option,\n * chat widget will be opened and not embedded. This prevents scroll issues\n * on mobile or small screens where the chat widget is larger than the current\n * browser height.\n *\n * Usage:\n\n<div id=\"ghl-chat-embed\"></div>\n<script type=\"module\">\n  import { embedChat } from \"https://cdn.jsdelivr.net/gh/levelupghl/ghlchattools@v1/dist/js/embedChat.min.js\";\n  embedChat(\"#ghl-chat-embed\", {minHeight: 700, autoScroll: true});\n</script>\n\n **/\n\nimport {\n  browserHeightLessThan,\n  isMobileBrowser,\n  scrollToElement,\n} from \"./lib/utils\"\n\nconst CHAT_EMBED_CONTAINER_SELECTOR = \"#ghl-chat-embed\"\nconst GHL_CHAT_WIDGET_SELECTOR = \"chat-widget\"\nconst DEFAULT_OPTIONS: Options = {\n  minHeight: 650,\n  autoScroll: false,\n  scrollOffset: 20,\n}\n\ninterface Options {\n  minHeight: number\n  autoScroll: boolean\n  scrollOffset: number\n}\n\nasync function waitForChatLoad(): Promise<void> {\n  return new Promise<void>((resolve) => {\n    const handler = (event: LCChatWidgetLoadedEvent) => {\n      resolve()\n      window.removeEventListener(\"LC_chatWidgetLoaded\", handler)\n    }\n    window.addEventListener(\"LC_chatWidgetLoaded\", handler, false)\n  })\n}\n\nfunction getOptions(options: Options | undefined): Options {\n  const opts = { ...DEFAULT_OPTIONS }\n  if (!options) {\n    return opts\n  }\n  try {\n    if (options.minHeight) {\n      opts.minHeight =\n        typeof options.minHeight === \"number\"\n          ? options.minHeight\n          : parseInt(options.minHeight)\n    }\n    if (options.autoScroll) {\n      opts.autoScroll = true\n      if (options.scrollOffset) {\n        opts.scrollOffset =\n          typeof options.scrollOffset === \"number\"\n            ? options.scrollOffset\n            : parseInt(options.scrollOffset)\n      }\n    }\n  } catch (err) {\n    console.error(`embedChat: invalid options, using defaults`)\n  }\n  return opts\n}\n\nexport const embedChat = async (\n  containerSelector: string | undefined,\n  options: Options | undefined\n) => {\n  const selector = containerSelector || CHAT_EMBED_CONTAINER_SELECTOR\n  const opts = getOptions(options)\n  const embedDiv = document.querySelector(selector) as HTMLElement\n\n  if (!embedDiv) {\n    console.error(\n      `embedChat: \"${selector}\" not found on page: unable to embed GHL chat widget`\n    )\n    return\n  }\n  if (!window.leadConnector?.chatWidget?.isLoaded) {\n    await waitForChatLoad()\n  }\n\n  // Open chat widget instead of embedding on mobile or small screens\n  if (isMobileBrowser() || browserHeightLessThan(opts.minHeight)) {\n    return window.leadConnector.chatWidget.openWidget()\n  }\n\n  const chat = document.querySelector(GHL_CHAT_WIDGET_SELECTOR)\n  const root = chat?.shadowRoot\n\n  if (!chat || !root) {\n    console.error(`embedChat: unable to find GHL chat widget on page`)\n    return\n  }\n\n  const bubble = root.querySelector(\".lc_text-widget--bubble\") as HTMLElement\n  const widget = root.querySelector(\".lc_text-widget\") as HTMLElement\n  const box = root.querySelector(\".lc_text-widget--box\") as HTMLElement\n\n  if (!bubble || !widget || !box) {\n    console.error(\n      `embedChat: unable to embed GHL chat widget in page: widget components not found`\n    )\n    return\n  }\n\n  // Remove the chat widget\n  chat.parentElement?.removeChild(chat)\n\n  // TODO: set overscroll to auto\n\n  widget.style.position = \"static\"\n  widget.style.width = \"100%\"\n  box.style.width = \"100%\"\n\n  // Hide the chat bubble\n  bubble.style.display = \"none\"\n\n  // Attach the chat widget to the in page container\n  embedDiv.appendChild(chat)\n\n  // Open chat widget\n  window.leadConnector.chatWidget.openWidget()\n\n  if (opts.autoScroll) {\n    setTimeout(() => {\n      scrollToElement(embedDiv, opts.scrollOffset)\n    }, 100)\n  }\n\n  // TODO: wait until after button click or observe DOM before attempting to get inner-scroll\n  // const innerscroll = root\n  //   .querySelector(\"chat-pane\")\n  //   .shadowRoot.querySelector(\"chat-conversation\")\n  //   .shadowRoot.querySelector(\"ion-content\")\n  //   .shadowRoot.querySelector(\".inner-scroll\") as HTMLElement\n  // if (inner?.style) {\n  //   inner.style.overscrollBehavior = \"auto\"\n  // }\n  // TODO: set ::slotted(.informational) fontSize = 14px\n}\n\n"],"names":[],"mappings":"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"}